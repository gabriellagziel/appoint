<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App-Oint Enterprise API Documentation</title>
    <link rel="stylesheet" type="text/css" href="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui.css" />
    <style>
        .enterprise-banner {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            margin-bottom: 20px;
        }

        .sandbox-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 14px;
        }

        .sandbox-button:hover {
            background: #218838;
        }

        .oauth-section {
            background: #f8f9fa;
            padding: 20px;
            margin: 20px 0;
            border-radius: 5px;
            border-left: 4px solid #007bff;
        }

        .enterprise-endpoints {
            background: #fff3cd;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            border-left: 4px solid #ffc107;
        }

        .try-sandbox-btn {
            background: #17a2b8;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 10px;
        }

        .try-sandbox-btn:hover {
            background: #138496;
        }
    </style>
</head>

<body>
    <div class="enterprise-banner">
        <h1>App-Oint Enterprise API</h1>
        <p>Complete API documentation with sandbox testing and enterprise features</p>
    </div>

    <div class="oauth-section">
        <h3>üîê OAuth2 Client Credentials Flow</h3>
        <p>Enterprise customers can authenticate using OAuth2 client credentials:</p>
        <div style="background: #f1f3f4; padding: 15px; border-radius: 5px; margin: 10px 0;">
            <strong>Token Endpoint:</strong> <code>https://api.appoint.com/oauth/token</code><br>
            <strong>Grant Type:</strong> <code>client_credentials</code><br>
            <strong>Scope:</strong> <code>enterprise:read enterprise:write</code>
        </div>
        <button class="sandbox-button" onclick="getOAuthToken()">Get OAuth Token</button>
        <button class="sandbox-button" onclick="testSandboxConnection()">Test Sandbox</button>
    </div>

    <div class="enterprise-endpoints">
        <h3>üöÄ Enterprise-Only Endpoints</h3>
        <ul>
            <li><strong>/api/enterprise/audit-logs</strong> - Retrieve audit logs</li>
            <li><strong>/api/enterprise/usage-metrics</strong> - Get usage metrics</li>
            <li><strong>/api/enterprise/bulk-operations</strong> - Bulk import/export</li>
            <li><strong>/api/enterprise/webhooks</strong> - Webhook management</li>
            <li><strong>/api/enterprise/ip-whitelist</strong> - IP allowlisting</li>
        </ul>
    </div>

    <div id="swagger-ui"></div>

    <script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-bundle.js"></script>
    <script src="https://unpkg.com/swagger-ui-dist@5.9.0/swagger-ui-standalone-preset.js"></script>
    <script>
        // Enhanced Swagger UI configuration
        const ui = SwaggerUIBundle({
            url: '/api/enterprise/openapi.yaml',
            dom_id: '#swagger-ui',
            deepLinking: true,
            presets: [
                SwaggerUIBundle.presets.apis,
                SwaggerUIStandalonePreset
            ],
            plugins: [
                SwaggerUIBundle.plugins.DownloadUrl
            ],
            layout: "StandaloneLayout",
            onComplete: function () {
                // Add "Try in Sandbox" buttons to enterprise endpoints
                addSandboxButtons();
            }
        });

        // OAuth2 Token Management
        let currentToken = null;

        async function getOAuthToken() {
            try {
                const response = await fetch('https://api.appoint.com/oauth/token', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: new URLSearchParams({
                        grant_type: 'client_credentials',
                        client_id: 'your-client-id',
                        client_secret: 'your-client-secret',
                        scope: 'enterprise:read enterprise:write'
                    })
                });

                const data = await response.json();
                if (data.access_token) {
                    currentToken = data.access_token;
                    alert('OAuth token obtained successfully!');
                    updateSwaggerAuth();
                } else {
                    alert('Failed to get OAuth token');
                }
            } catch (error) {
                console.error('OAuth error:', error);
                alert('Error getting OAuth token');
            }
        }

        function updateSwaggerAuth() {
            if (currentToken) {
                // Update Swagger UI with the token
                ui.preauthorizeApiKey('BearerAuth', `Bearer ${currentToken}`);
            }
        }

        async function testSandboxConnection() {
            try {
                const sandboxId = prompt('Enter your sandbox ID:');
                if (!sandboxId) return;

                const response = await fetch(`https://sandbox-${sandboxId}.appoint.com/health`);
                const data = await response.json();

                if (data.status === 'healthy') {
                    alert('Sandbox connection successful!');
                } else {
                    alert('Sandbox connection failed');
                }
            } catch (error) {
                console.error('Sandbox test error:', error);
                alert('Error testing sandbox connection');
            }
        }

        function addSandboxButtons() {
            // Add "Try in Sandbox" buttons to enterprise endpoints
            const operationElements = document.querySelectorAll('.opblock-summary');

            operationElements.forEach(element => {
                const operationId = element.getAttribute('data-operation-id');
                if (operationId && operationId.includes('enterprise')) {
                    const button = document.createElement('button');
                    button.className = 'try-sandbox-btn';
                    button.textContent = 'Try in Sandbox';
                    button.onclick = () => tryInSandbox(operationId);
                    element.appendChild(button);
                }
            });
        }

        function tryInSandbox(operationId) {
            const sandboxId = prompt('Enter your sandbox ID:');
            if (!sandboxId) return;

            // Redirect to sandbox with the operation
            const sandboxUrl = `https://sandbox-${sandboxId}.appoint.com/docs#/${operationId}`;
            window.open(sandboxUrl, '_blank');
        }

        // Enhanced OpenAPI spec with enterprise features
        const enhancedSpec = {
            openapi: "3.0.3",
            info: {
                title: "App-Oint Enterprise API",
                description: "Complete API documentation for App-Oint Enterprise customers with sandbox testing capabilities",
                version: "2.0.0",
                contact: {
                    name: "App-Oint Enterprise Support",
                    email: "enterprise@appoint.com"
                }
            },
            servers: [
                {
                    url: "https://api.appoint.com/v2",
                    description: "Production API"
                },
                {
                    url: "https://sandbox-{sandboxId}.appoint.com",
                    description: "Sandbox Environment",
                    variables: {
                        sandboxId: {
                            default: "demo",
                            description: "Your sandbox ID"
                        }
                    }
                }
            ],
            security: [
                {
                    BearerAuth: []
                },
                {
                    OAuth2: ["enterprise:read", "enterprise:write"]
                }
            ],
            paths: {
                "/api/enterprise/audit-logs": {
                    get: {
                        summary: "Get Audit Logs",
                        description: "Retrieve audit logs for enterprise compliance",
                        tags: ["Enterprise"],
                        security: [
                            {
                                BearerAuth: []
                            }
                        ],
                        parameters: [
                            {
                                name: "startDate",
                                in: "query",
                                schema: {
                                    type: "string",
                                    format: "date"
                                }
                            },
                            {
                                name: "endDate",
                                in: "query",
                                schema: {
                                    type: "string",
                                    format: "date"
                                }
                            }
                        ],
                        responses: {
                            "200": {
                                description: "Audit logs retrieved successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            type: "array",
                                            items: {
                                                $ref: "#/components/schemas/AuditLog"
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "/api/enterprise/usage-metrics": {
                    get: {
                        summary: "Get Usage Metrics",
                        description: "Retrieve API usage metrics and analytics",
                        tags: ["Enterprise"],
                        responses: {
                            "200": {
                                description: "Usage metrics retrieved successfully",
                                content: {
                                    "application/json": {
                                        schema: {
                                            $ref: "#/components/schemas/UsageMetrics"
                                        }
                                    }
                                }
                            }
                        }
                    }
                },
                "/api/enterprise/bulk-operations": {
                    post: {
                        summary: "Bulk Import/Export",
                        description: "Perform bulk operations for data import/export",
                        tags: ["Enterprise"],
                        requestBody: {
                            required: true,
                            content: {
                                "application/json": {
                                    schema: {
                                        $ref: "#/components/schemas/BulkOperation"
                                    }
                                }
                            }
                        },
                        responses: {
                            "202": {
                                description: "Bulk operation initiated",
                                content: {
                                    "application/json": {
                                        schema: {
                                            $ref: "#/components/schemas/BulkOperationStatus"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            },
            components: {
                securitySchemes: {
                    BearerAuth: {
                        type: "http",
                        scheme: "bearer",
                        bearerFormat: "JWT"
                    },
                    OAuth2: {
                        type: "oauth2",
                        flows: {
                            clientCredentials: {
                                tokenUrl: "https://api.appoint.com/oauth/token",
                                scopes: {
                                    "enterprise:read": "Read enterprise data",
                                    "enterprise:write": "Write enterprise data"
                                }
                            }
                        }
                    }
                },
                schemas: {
                    AuditLog: {
                        type: "object",
                        properties: {
                            id: {
                                type: "string"
                            },
                            timestamp: {
                                type: "string",
                                format: "date-time"
                            },
                            userId: {
                                type: "string"
                            },
                            action: {
                                type: "string"
                            },
                            resource: {
                                type: "string"
                            },
                            details: {
                                type: "object"
                            }
                        }
                    },
                    UsageMetrics: {
                        type: "object",
                        properties: {
                            apiCalls: {
                                type: "integer"
                            },
                            dataTransfer: {
                                type: "integer"
                            },
                            activeUsers: {
                                type: "integer"
                            },
                            period: {
                                type: "string"
                            }
                        }
                    },
                    BulkOperation: {
                        type: "object",
                        properties: {
                            operation: {
                                type: "string",
                                enum: ["import", "export"]
                            },
                            dataType: {
                                type: "string",
                                enum: ["users", "bookings", "businesses"]
                            },
                            fileUrl: {
                                type: "string"
                            }
                        }
                    },
                    BulkOperationStatus: {
                        type: "object",
                        properties: {
                            operationId: {
                                type: "string"
                            },
                            status: {
                                type: "string",
                                enum: ["pending", "processing", "completed", "failed"]
                            },
                            progress: {
                                type: "integer"
                            }
                        }
                    }
                }
            }
        };

        // Initialize with enhanced spec
        ui.initOAuth({
            clientId: "your-client-id",
            clientSecret: "your-client-secret",
            realm: "appoint-enterprise",
            appName: "App-Oint Enterprise API",
            scopeSeparator: " ",
            additionalQueryStringParams: {}
        });
    </script>
</body>

</html>